<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mRides: 1. Create and configure an authenticator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="DoxygenLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mRides
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_m_rides-app__components_xamarin_8auth-1_82_83_81_component__getting_started.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title"><ol type="1">
<li>Create and configure an authenticator </li>
</ol>
</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Let's authenticate a user to access Facebook:</p>
<div class="fragment"><div class="line">using Xamarin.Auth;</div><div class="line">...</div><div class="line">var auth = new OAuth2Authenticator (</div><div class="line">    clientId: &quot;App ID from https://developers.facebook.com/apps&quot;,</div><div class="line">    scope: &quot;&quot;,</div><div class="line">    authorizeUrl: new Uri (&quot;https://m.facebook.com/dialog/oauth/&quot;),</div><div class="line">    redirectUrl: new Uri (&quot;http://www.facebook.com/connect/login_success.html&quot;));</div></div><!-- fragment --><p>Facebook uses OAuth 2.0 authentication, so we create an <code>OAuth2Authenticator</code>. Authenticators are responsible for managing the user interface and communicating with authentication services.</p>
<p>Authenticators take a variety of parameters; in this case, the application's ID, its authorization scope, and Facebook's various service locations are required.</p>
<h2>2. Authenticate the user</h2>
<p>While authenticators manage their own UI, it's up to you to initially present the authenticator's UI on the screen. This lets you control how the authentication UI is displayed–modally, in navigation controllers, in popovers, etc.</p>
<p>Before we present the UI, we need to start listening to the <code>Completed</code> event which fires when the user successfully authenticates or cancels. You can find out if the authentication succeeded by testing the <code>IsAuthenticated</code> property of <code>eventArgs</code>:</p>
<div class="fragment"><div class="line">auth.Completed += (sender, eventArgs) =&gt; {</div><div class="line">    // We presented the UI, so it&#39;s up to us to dimiss it on iOS.</div><div class="line">    DismissViewController (true, null);</div><div class="line"></div><div class="line">    if (eventArgs.IsAuthenticated) {</div><div class="line">        // Use eventArgs.Account to do wonderful things</div><div class="line">    } else {</div><div class="line">        // The user cancelled</div><div class="line">    }</div><div class="line">};</div></div><!-- fragment --><p>All the information gathered from a successful authentication is available in <code>eventArgs.Account</code>.</p>
<p>Now we're ready to present the login UI from <code>ViewDidAppear</code> on iOS:</p>
<div class="fragment"><div class="line">PresentViewController (auth.GetUI (), true, null);</div></div><!-- fragment --><p>The <code>GetUI</code> method returns <code>UINavigationControllers</code> on iOS, and <code>Intents</code> on Android. On Android, we would write the following code to present the UI from <code>OnCreate</code>:</p>
<div class="fragment"><div class="line">StartActivity (auth.GetUI (this));</div></div><!-- fragment --><h2>3. Making requests</h2>
<p>Since Facebook is an OAuth2 service, we'll make requests with <code>OAuth2Request</code> providing the account we retrieved from the <code>Completed</code> event. Assuming we're authenticated, we'll grab the user's info to demonstrate:</p>
<div class="fragment"><div class="line">var request = new OAuth2Request (&quot;GET&quot;, new Uri (&quot;https://graph.facebook.com/me&quot;), null, eventArgs.Account);</div><div class="line">request.GetResponseAsync().ContinueWith (t =&gt; {</div><div class="line">    if (t.IsFaulted)</div><div class="line">        Console.WriteLine (&quot;Error: &quot; + t.Exception.InnerException.Message);</div><div class="line">    else {</div><div class="line">        string json = t.Result.GetResponseText();</div><div class="line">        Console.WriteLine (json);</div><div class="line">    }</div><div class="line">});</div></div><!-- fragment --><h2>4. Store the account</h2>
<p><a class="el" href="namespace_xamarin_1_1_auth.html">Xamarin.Auth</a> securely stores <code>Account</code> objects so that you don't always have to reauthenticate the user. The <code>AccountStore</code> class is responsible for storing <code>Account</code> information, backed by the <a href="https://developer.apple.com/library/ios/#documentation/security/Reference/keychainservices/Reference/reference.html">Keychain</a> on iOS and a <a href="http://developer.android.com/reference/java/security/KeyStore.html">KeyStore</a> on Android:</p>
<div class="fragment"><div class="line">// On iOS:</div><div class="line">AccountStore.Create ().Save (eventArgs.Account, &quot;Facebook&quot;);</div><div class="line"></div><div class="line">// On Android:</div><div class="line">AccountStore.Create (this).Save (eventArgs.Account, &quot;Facebook&quot;);</div></div><!-- fragment --><p>Saved Accounts are uniquely identified using a key composed of the account's <code>Username</code> property and a "Service ID". The "Service ID" is any string that is used when fetching accounts from the store.</p>
<p>If an <code>Account</code> was previously saved, calling <code>Save</code> again will overwrite it. This is convenient for services that expire the credentials stored in the account object.</p>
<h2>5. Retrieve stored accounts</h2>
<p>You can fetch all <code>Account</code> objects stored for a given service:</p>
<div class="fragment"><div class="line">// On iOS:</div><div class="line">IEnumerable&lt;Account&gt; accounts = AccountStore.Create ().FindAccountsForService (&quot;Facebook&quot;);</div><div class="line"></div><div class="line">// On Android:</div><div class="line">IEnumerable&lt;Account&gt; accounts = AccountStore.Create (this).FindAccountsForService (&quot;Facebook&quot;);</div></div><!-- fragment --><p>It's that easy.</p>
<h2>6. Make your own authenticator</h2>
<p><a class="el" href="namespace_xamarin_1_1_auth.html">Xamarin.Auth</a> includes OAuth 1.0 and OAuth 2.0 authenticators, providing support for thousands of popular services. For services that use traditional username/password authentication, you can roll your own authenticator by deriving from <code>FormAuthenticator</code>.</p>
<p>If you want to authenticate against an ostensibly unsupported service, fear not – <a class="el" href="namespace_xamarin_1_1_auth.html">Xamarin.Auth</a> is extensible! It's very easy to create your own authenticators – just derive from any of the existing authenticators and start overriding methods. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
